subdir-m += avl
subdir-m += nvpair
subdir-m += unicode
subdir-m += zcommon
subdir-m += zfs
subdir-m += zpios

modules:
	@# Make the exported SPL symbols available to these modules.
	@# They may be in the root of SPL_OBJ when building against
	@# installed devel headers, or they may be in the module
	@# subdirectory when building against the spl source tree.
@CONFIG_KERNEL_TRUE@	@if [ -f @SPL_OBJ@/@SPL_SYMBOLS@ ]; then \
@CONFIG_KERNEL_TRUE@		/bin/cp @SPL_OBJ@/@SPL_SYMBOLS@ .; \
@CONFIG_KERNEL_TRUE@	elif [ -f @SPL_OBJ@/module/@SPL_SYMBOLS@ ]; then \
@CONFIG_KERNEL_TRUE@		/bin/cp @SPL_OBJ@/module/@SPL_SYMBOLS@ .; \
@CONFIG_KERNEL_TRUE@	else \
@CONFIG_KERNEL_TRUE@		echo -e "\n" \
@CONFIG_KERNEL_TRUE@		"*** Missing spl symbols ensure you have built the spl:\n" \
@CONFIG_KERNEL_TRUE@		"*** - @SPL_OBJ@/@SPL_SYMBOLS@, or\n" \
@CONFIG_KERNEL_TRUE@		"*** - @SPL_OBJ@/module/@SPL_SYMBOLS@\n"; \
@CONFIG_KERNEL_TRUE@		exit 1; \
@CONFIG_KERNEL_TRUE@	fi
@CONFIG_KERNEL_TRUE@	$(MAKE) -C @LINUX_OBJ@ SUBDIRS=`pwd` @KERNELMAKE_PARAMS@ $@

clean:
@CONFIG_KERNEL_TRUE@	$(MAKE) -C @LINUX_OBJ@ SUBDIRS=`pwd` @KERNELMAKE_PARAMS@ $@
@CONFIG_KERNEL_TRUE@	if [ -f @SPL_SYMBOLS@ ]; then $(RM) @SPL_SYMBOLS@; fi
@CONFIG_KERNEL_TRUE@	if [ -f @LINUX_SYMBOLS@ ]; then $(RM) @LINUX_SYMBOLS@; fi
@CONFIG_KERNEL_TRUE@	if [ -f Module.markers ]; then $(RM) Module.markers; fi

modules_install:
@CONFIG_KERNEL_TRUE@	@# Install the kernel modules
@CONFIG_KERNEL_TRUE@	$(MAKE) -C @LINUX_OBJ@ SUBDIRS=`pwd` \
@CONFIG_KERNEL_TRUE@		INSTALL_MOD_PATH=$(DESTDIR) \
@CONFIG_KERNEL_TRUE@		INSTALL_MOD_DIR=addon/zfs $@
@CONFIG_KERNEL_TRUE@	find $(DESTDIR)/lib/modules/ -name 'modules.*' | xargs $(RM)
@CONFIG_KERNEL_TRUE@	sysmap=$(DESTDIR)/boot/System.map-@LINUX_VERSION@; \
@CONFIG_KERNEL_TRUE@	if [ -f $$sysmap ]; then \
@CONFIG_KERNEL_TRUE@		depmod -ae -F $$sysmap @LINUX_VERSION@; \
@CONFIG_KERNEL_TRUE@	fi

modules_uninstall:
@CONFIG_KERNEL_TRUE@	@# Uninstall the kernel modules
@CONFIG_KERNEL_TRUE@	$(RM) -R $(DESTDIR)/lib/modules/@LINUX_VERSION@/addon/zfs

distdir:

distclean maintainer-clean: clean
@CONFIG_KERNEL_FALSE@	-rm -f Makefile */Makefile

install: modules_install
uninstall: modules_uninstall
all: modules
check:
